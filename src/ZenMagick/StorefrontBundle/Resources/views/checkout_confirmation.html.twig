<?php use ZenMagick\Base\Toolbox; ?>
<?php $view->extend('StorefrontBundle::default_layout.html.php'); ?>

<?php $view['slots']->set('crumbtrail', $crumbtrail->addCrumb(_zm('Checkout'), $view['router']->generate('checkout'))->addCrumb(_zm('Summary'))); ?>
<fieldset>
    <legend><?php _vzm("Shopping Cart Contents") ?></legend>
    <table cellpadding="0" cellspacing="0" id="cart">
        <tbody>
        <?php foreach ($shoppingCart->getItems() as $item) { ?>
            <tr>
                <td class="itm">
                    <?php echo $item->getQuantity() ?> x <?php echo $view->escape($item->getProduct()->getName()) ?>
                    <?php if ($item->hasAttributes()) { ?>
                        <br/>
                        <?php foreach ($item->getAttributes() as $attribute) { ?>
                            <p><span class="attr"><?php echo $view->escape($attribute->getName()) ?>:</span>
                            <?php $first = true; foreach ($attribute->getValues() as $attributeValue) { ?>
                                <?php if (!$first) { ?>, <?php } ?>
                                <span class="atval"><?php echo $view->escape($attributeValue->getName()) ?></span>
                            <?php $first = false; } ?>
                            </p>
                        <?php } ?>
                    <?php } ?>
                </td>
                <td class="price">
                    <?php echo $utils->formatMoney($item->getItemTotal()) ?>
                    <?php if (0 != ($oneTimeCharge = $item->getOneTimeCharge())) { ?>
                        <br><?php _vzm('One time: %s', $utils->formatMoney($oneTimeCharge)) ?>
                    <?php } ?>
                </td>
            </tr>
        <?php } ?>
          <?php
              $totals = $shoppingCart->getTotals();
              foreach ($totals as $total) {
                  $tot = '';
                  if ('total' == $total->getType()) {
                      $tot = ' tot';
                  }
                  ?><tr><td class="total"><?php echo $view->escape($total->getName()) ?></td><td class="price<?php echo $tot ?>"><?php echo $total->getValue() ?></td></tr><?php
              }
          ?>

        </tbody>
    </table>
</fieldset>

<fieldset>
    <legend><?php _vzm("Payment Method") ?></legend>
    <div class="btn"><a class="btn" href="<?php echo $view['router']->generate('checkout_payment') ?>"><?php _vzm("Change") ?></a></div>
    <?php $paymentType = $shoppingCart->getSelectedPaymentType() ?>
    <?php if (null != $paymentType) { ?>
      <h4><?php echo $paymentType->getName() ?></h4>
      <?php if (!Toolbox::isEmpty($paymentType->getInfo())) { ?>
        <p><?php echo nl2br($paymentType->getInfo()) ?></p>
      <?php } ?>
    <?php } ?>
</fieldset>

<?php if (!$shoppingCart->isVirtual()) { ?>
    <fieldset>
        <legend><?php _vzm("Shipping") ?></legend>
        <div class="btn"><a class="btn" href="<?php echo $view['router']->generate('checkout_shipping') ?>"><?php _vzm("Change") ?></a></div>
        <br/>
        <?php if (null != ($shippingMethod = $shoppingCart->getSelectedShippingMethod())) { ?>
          <?php echo $view->escape($shippingMethod->getProvider()->getName()) . ': ' . $view->escape($shippingMethod->getName()) ?><br/>
        <?php } ?>
    </fieldset>
<?php } ?>

<fieldset>
    <legend><?php _vzm("Address Information") ?></legend>
    <?php if ($shoppingCart->hasShippingAddress()) { ?>
        <div class="oadr">
            <div class="btn"><a class="btn" href="<?php echo $view['router']->generate('checkout_shipping_address') ?>"><?php _vzm("Change") ?></a></div>
            <h4><?php _vzm("Shipping Address") ?></h4>
            <?php echo $macro->formatAddress($shoppingCart->getShippingAddress()) ?>
        </div>
    <?php } else { ?>
        <div class="oadr">
            <h4><?php _vzm("Shipping Address") ?></h4>
            <?php _vzm("N/A") ?>
        </div>
    <?php } ?>
    <div class="oadr snd">
        <div class="btn"><a class="btn" href="<?php echo $view['router']->generate('checkout_payment_address') ?>"><?php _vzm("Change") ?></a></div>
        <h4><?php _vzm("Billing Address") ?></h4>
        <?php echo $macro->formatAddress($shoppingCart->getBillingAddress()) ?>
    </div>
</fieldset>

<fieldset>
    <legend><?php _vzm("Special instructions or comments") ?></legend>
    <div class="btn"><a class="btn" href="<?php echo $view['router']->generate('checkout_payment') ?>"><?php _vzm("Change") ?></a></div>
    <div><?php echo $view->escape(!Toolbox::isEmpty($shoppingCart->getComments()) ? $shoppingCart->getComments() : "None") ?></div>
</fieldset>

<?php echo $form->open($orderFormUrl, '', true) ?>
    <?php echo $orderFormContent ?>
    <div class="btn"><input type="submit" class="btn" value="<?php _vzm("Confirm to order") ?>" /></div>
</form>
