{% extend '@Storefront/popup_layout.html.twig' %}
{% block body %}
<?php
  $restrictions = $coupon->getRestrictions();
  $fixed = _zm('This coupon entitles you to a %s discount against your order');
  if ($coupon::TYPPE_FIXED == $coupon->getType()) {
      $discount = sprintf($fixed, utils.formatMoney(coupon.amount));
  } elseif ($coupon::TYPPE_PERCENT == $coupon->getType()) {
      $discount = sprintf($fixed, number_format($coupon->getAmount(), $view['settings']->get('discountDecimals')).'%');
  } else {
      $discount = _zm('This coupon gives you free shipping on your order');
  }
?>
<h2>{{ 'Congratulations, you have redeemed a Discount Coupon.'|trans }}</h2>
<p>
  {{ 'Coupon Name: %name%|trans({'%name%' : coupon.name}) }}<br/>
  {{ 'Coupon Description: %description%'|trans({'%description%' : coupon.description}) }}<br/>
  <?php echo $discount ?>
</p>

<p>{{ 'The discount is valid between %start_date% and %end_date%.'|trans({'%start_date%' : coupon.startDate|localizeddate('short', 'none'), '%end_date%' : coupon.expiryDate|localizeddate('short', 'none')}) }}</p>

<?php if ($restrictions->hasCategories()) { ?>
    <h4> {{ 'Category Restrictions'|trans }} </h4>
    <ul>
    <?php foreach ($restrictions->getCategories() as $restriction) { $category = $restriction->getCategory($view['request']->getLocaleId()); ?>
        <li>{{ category.name }} - <?php echo ($restriction->isAllowed() ? _zm(" included") : _zm(" excluded")) ?></li>
    <?php } ?>
    </ul>
<?php } ?>

<?php if ($restrictions->hasProducts()) { ?>
    <h4>{{ 'Product Restrictions'|trans }}</h4>
    <ul>
    <?php foreach ($restrictions->getProducts() as $restriction) { $product = $restriction->getProduct($view['request']->getLocaleId()); ?>
        <li>{{ product.name }} - <?php echo ($restriction->isAllowed() ? _zm(" included") : _zm(" excluded")) ?></li>
    <?php } ?>
    </ul>
<?php } ?>

<?php if (!$restrictions->hasRestrictions()) { ?>
    <h4>{{ 'The coupon is valid for all categories and products.'|trans }}</h4>
<?php } ?>

<p>{{ 'Discount Coupons may not be applied towards the purchase of Gift Certificates.'|trans }}</p>

<div id="close"><a href="#" onclick="javascript:window.close()">{{ 'Close Window [x]'|trans }}</a></div>
{% endblock %}
