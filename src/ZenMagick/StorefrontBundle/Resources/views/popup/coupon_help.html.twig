<?php $view->extend('StorefrontBundle::popup_layout.html.php'); ?>
<?php
  $restrictions = $coupon->getRestrictions();
  $fixed = _zm('This coupon entitles you to a %s discount against your order');
  if ($coupon::TYPPE_FIXED == $coupon->getType()) {
      $discount = sprintf($fixed, $utils->formatMoney($coupon->getAmount()));
  } elseif ($coupon::TYPPE_PERCENT == $coupon->getType()) {
      $discount = sprintf($fixed, number_format($coupon->getAmount(), $view['settings']->get('discountDecimals')).'%');
  } else {
      $discount = _zm('This coupon gives you free shipping on your order');
  }
?>
<h2><?php _vzm("Congratulations, you have redeemed a Discount Coupon.") ?></h2>
<p>
  <?php _vzm("Coupon Name: %s", $coupon->getName()) ?><br/>
  <?php _vzm("Coupon Description: %s", $coupon->getDescription()) ?><br/>
  <?php echo $discount ?>
</p>

<p><?php _vzm("The discount is valid between %s and %s.", $view['date']->short($coupon->getStartDate()), $view['date']->short($coupon->getExpiryDate())) ?></p>

<?php if ($restrictions->hasCategories()) { ?>
    <h4><?php _vzm("Category Restrictions")?></h4>
    <ul>
    <?php foreach ($restrictions->getCategories() as $restriction) { $category = $restriction->getCategory($view['request']->getLocaleId()); ?>
        <li><?php echo $view->escape($category->getName()) ?> - <?php echo ($restriction->isAllowed() ? _zm(" included") : _zm(" excluded")) ?></li>
    <?php } ?>
    </ul>
<?php } ?>

<?php if ($restrictions->hasProducts()) { ?>
    <h4><?php _vzm("Product Restrictions")?></h4>
    <ul>
    <?php foreach ($restrictions->getProducts() as $restriction) { $product = $restriction->getProduct($view['request']->getLocaleId()); ?>
        <li><?php echo $view->escape($product->getName()) ?> - <?php echo ($restriction->isAllowed() ? _zm(" included") : _zm(" excluded")) ?></li>
    <?php } ?>
    </ul>
<?php } ?>

<?php if (!$restrictions->hasRestrictions()) { ?>
    <h4><?php _vzm("The coupon is valid for all categories and products.") ?></h4>
<?php } ?>

<p><?php _vzm("Discount Coupons may not be applied towards the purchase of Gift Certificates.") ?></p>

<div id="close"><a href="#" onclick="javascript:window.close()"><?php _vzm("Close Window [x]") ?></a></div>
