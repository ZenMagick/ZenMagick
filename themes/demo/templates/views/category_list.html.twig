{% extends '@Storefront/layout.html.twig' %}
{% block body %}
    <script type="text/javascript">
        {% autoescape 'js' %}
        // set up drag/drop
        $(document).ready(function() {
            $('a.product').Draggable({revert:true, fx:300, ghosting:true, opacity:0.4});
            $('#sb_cart').Droppable({
                accept: 'product',
                activeclass: 'activeCart',
                hoverclass: 'hoverCart',
                tolerance: 'intersect',
                onActivate: function(dragged) {
                  if (!this.shakedFirstTime) {
                    $(this).Shake(3);
                    this.shakedFirstTime = true;
                  }
                },
                onDrop: addProductToCart
            });
        });

        // add to cart action
        var addProductToCart = function(dragged) {
        // product_[id]
        var productId = $(dragged).attr('id');
        var loff = productId.lastIndexOf('_');
        var productId = parseInt(productId.substring(loff+1));
        if ('NaN' != productId) {
            $('#cart_progress').show();
            $.ajax({
                type: "POST",
                url: "{{ net.ajax('shopping_cart', 'addProduct') }}",
                data: "productId="+productId+"&quantity=1",
                success: function(msg) {
                    // declared in sidebox, so easier to change layout...
                    updateSBCartContent(msg);
                }
            });
        }
      };
        {% endautoescape %}
    </script>

    <h2>Drag products into your shopping cart</h2>
    {% if resultList.hasResults %}
        <div class="rnblk">
            {{ include('@Storefront/resultlist/nav.html.twig') }}
            {{ include('@Storefront/resultlist/options.html.twig') }}
        </div>

        <div class="rlist">
            <table>
                <tbody>
                    {% for product in resultList.results %}
                        {{ include('@Storefront/resultlist/product.html.twig', {'loop' : loop}) }}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="rnblk">
            {{ include('@Storefront/resultlist/nav.html.twig') }}
        </div>
    {% else %}
        <h2>{{ 'There are no products in this category'|trans }}</h2>
    {% endif %}
{% endblock %}
