<project name="zenmagick-plugins" default="plugin-releases" basedir=".">

    <!-- Plugins properties -->
    <property file="plugins.properties" />

    <!-- Build plugin releases -->
    <target name="plugin-releases" depends="clean,init" description="Build plugin releases.">
        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_google_adsense" />
            <param name="plugin.version" value="${plugins.zm_google_adsense.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_google_analytics" />
            <param name="plugin.version" value="${plugins.zm_google_analytics.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_rss_boxes" />
            <param name="plugin.version" value="${plugins.zm_rss_boxes.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_wiki" />
            <param name="plugin.version" value="${plugins.zm_wiki.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_useo2" />
            <param name="plugin.version" value="${plugins.zm_useo2.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_useo3" />
            <param name="plugin.version" value="${plugins.zm_useo3.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_imagehandler2" />
            <param name="plugin.version" value="${plugins.zm_imagehandler2.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_captcha" />
            <param name="plugin.version" value="${plugins.zm_captcha.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_product_music_info" />
            <param name="plugin.version" value="${plugins.zm_product_music_info.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_crossell" />
            <param name="plugin.version" value="${plugins.zm_crossell.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_google_store_locator" />
            <param name="plugin.version" value="${plugins.zm_google_store_locator.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_smarty" />
            <param name="plugin.version" value="${plugins.zm_smarty.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_master_password" />
            <param name="plugin.version" value="${plugins.zm_master_password.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_recaptcha" />
            <param name="plugin.version" value="${plugins.zm_recaptcha.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_php_bb" />
            <param name="plugin.version" value="${plugins.zm_php_bb.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_pretty_links" />
            <param name="plugin.version" value="${plugins.zm_pretty_links.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_split_page_result_list" />
            <param name="plugin.version" value="${plugins.zm_split_page_result_list.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_page_cache" />
            <param name="plugin.version" value="${plugins.zm_page_cache.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_site_switch" />
            <param name="plugin.version" value="${plugins.zm_site_switch.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_hoverbox3" />
            <param name="plugin.version" value="${plugins.zm_hoverbox3.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_page_stats" />
            <param name="plugin.version" value="${plugins.zm_page_stats.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_multi_qty" />
            <param name="plugin.version" value="${plugins.zm_multi_qty.version}" />
        </antcall>

        <antcall target="plugin-release">
            <param name="plugin.name" value="zm_cron" />
            <param name="plugin.version" value="${plugins.zm_cron.version}" />
        </antcall>
    </target>

    
    <!-- Create release for a single plugin -->
    <target name="plugin-release" description="Create release for a single plugin.">
        <mkdir dir="${build.dir}/plugins" />

        <copy todir="${build.dir}/plugins">
          <fileset dir="${zenmagick.src.dir}/plugins">
                <include name="request/${plugin.name}.php" />
                <include name="request/${plugin.name}/**" />
            </fileset>
        </copy>

        <echo message="Versioning ${build.dir}/plugins/** ..." />
        <!-- '$$': escape Ant property expansion, '\': escape regexp '$' handling, '\}' required for JDK regexp implementation -->
        <replaceregexp match="\$$\{plugin.version\}" replace="${plugin.version}" flags="g"><fileset dir="${build.dir}/plugins" /></replaceregexp>

        <zip zipfile="${dist.dir}/plugin-${plugin.name}-${plugin.version}.zip">
            <fileset dir="${build.dir}/plugins">
                <include name="request/${plugin.name}.php" />
                <include name="request/${plugin.name}/**" />
            </fileset>
        </zip>
        <checksum file="${dist.dir}/md5/plugin-${plugin.name}-${plugin.version}.zip" fileext=".md5"/>
    </target>

</project>
